# 遊戲開發修改紀錄 (Modification History)

## [1.9.7] - 2026-02-02 (戰鬥回饋機制改進)

- `server/services/gameService.js`:
  - **新增基礎攻擊獎勵**：現在任何玩家只要**攻擊成功（造成傷害）**，將立即**恢復 3 HP**。
  - 此改動旨在鼓勵玩家主動出擊，並將戰鬥轉化為一種資源獲取手段，緩解升級所需的經濟壓力。
- `client/src/components/GameRules.vue`:
  - 更新版本號至 v1.9.7。
  - 在「遊戲流程 - 攻擊階段」中明確標註「攻擊成功者可恢復 3 HP」。

## [1.9.6] - 2026-02-02 (數值回滾與平衡重置)

- **全面回滾 v1.9.5 的數值改動**：
  - `INITIAL_HP` 回復至 **28**（原 32）。
  - `LEVEL_STATS` Lv1 防禦力回復至 **0**（原 1）。
  - 移除「回合生存獎勵」恢復 2 HP 的機制。
- **原因**：根據測試反饋，過多的血量供給導致玩家參與競標的門檻過低，且戰局容易陷入僵持而不易出現淘汰，不符合預期的快節奏博弈感。

## [1.9.5] - 2026-02-02 (經濟與升級平衡性調優 - 已回滾)

- `server/config/gameConstants.js`:
  - **初始血量上調**：`INITIAL_HP` 從 28 提升至 **32**。給予玩家更多「風險資本」去進行早期投資（升級或競標）。
  - **Lv1 數值強化**：Lv1 新增 **1 點保底防禦力** (原本 0)。讓升級不再只是攻擊手段，更是有效的生存投資，可降低後續回合受到的基傷。
- `server/services/gameService.js`:
  - **新增回合生存獎勵 (Round Income)**：在攻擊階段結束、進入競標前，所有存活玩家將自動恢復 **2 HP** (上限 40)。
  - 這項改動旨在緩解「第一回合被打就沒錢升級」的窘境，並讓玩家在持久戰中更有資源參與競標。
- `client/src/components/GameRules.vue`:
  - 同步更新遊戲規則說明，標註最新的血量、等級數值與存活獎勵機制。

## [1.9.4] - 2026-02-02 (屬性分配公平性優化)

- `server/services/gameService.js`:
  - **智慧屬性分配重構 (Option 2)**：將原本「水火木平均，餘數給雷」的硬性規則改為「動態擾動分配」。
  - **提升雷屬性存在感**：現在雷屬性擁有約 20% 的保底份額（例如 6 人局現在至少會出現 2 名雷屬性，原本為 0 名），解決了小規模對局中雷屬性因稀缺而太好被猜中的問題。
  - **引入擾動機制**：在保底屬性填滿後，賸餘名額將完全隨機分配給四種屬性，打破「算人數就能推導屬性」的博弈死角。

## [1.9.3] - 2026-02-02 (管理員介面與流程體驗優化)

- `client/src/components/AdminPanel.vue`:
  - **用語精簡**：將建立戰局處的「配置技能」按鈕文字改為「技能」，讓介面更簡潔。
  - **佈局壓縮 (Spacing Optimization)**：大幅減少「玩家管理」標題區域的垂直間距，移除 `h3` 標籤預設的外距並縮小字體，解決元素看起來過於分散的問題，提升介面整體平衡感。
- `package.json` & `server/routes/gameRoutes.js`:
  - 同步更新版本號至 `1.9.3`。

## [1.9.2-Hotfix-AttackStalemate] - 2026-02-02 (攻擊階段僵局修復)

- `server/services/gameService.js`:
  - **死亡判定順序修正**：調整了 `handleAttackFlow` 中的執行順序，確保先處理死亡判定 (`hp <= 0`)，再執行「快速跳轉檢查 (`checkAttackFastForward`)」。這解決了玩家攻擊途中死亡後，系統仍將其視為「存活且未行動」，導致遊戲卡住不進入下一階段的 Bug。
  - **僵局檢測 (Stalemate Detection)**：在 `checkAttackFastForward` 中新增了智慧僵局判定。當場上最後一位未行動的玩家因規則限制（如：反擊限制、無法攻擊手下、或目標不可被攻擊）而導致「全場無合法目標」時，系統現在會正確識別此狀況，將其視為「行動完畢」，並自動觸發階段結束，防止遊戲進入死結。
- **互動回饋優化 (UI Feedback)**：
  - **彈出式視窗 (Toast Notifications)**：新增了全域的彈出訊息機制。現在當玩家執行攻擊、使用技能、偵查或升級時，若操作成功或失敗，畫面中上方會出現醒目的提示視窗 (Toast)，讓玩家能即時確認操作結果，不用再辛苦翻閱下方的文字日誌。
  - **攻擊確認回饋**：優化了攻擊與技能的後端回傳資料 (`attackerId`)，讓前端能精確判斷「是誰打誰」，並針對「自己發動的攻擊」與「自己受到的攻擊」顯示不同顏色的即時通知（綠色為成功/被反擊，紅色為受傷/錯誤）。
  - **介面寬度調整**：將遊戲主容器的最大寬度由 480px 調整為 400px，以更貼近目前主流手機的直式操作手感。

## [1.9.1] - 2026-02-02 (生產環境日誌優化)

- `server/routes/gameRoutes.js`:
  - **日誌降噪 (Log Reduction)**：移除全自動流程 (AutoPilot) 啟動時重複顯示的「遊戲正式開始！本階段討論時間...」系統日誌。該訊息已在前一階段涵蓋，移除後可大幅減少玩家日誌區的洗版狀況，提升閱讀體驗。
  - **介面修正 (UI Fix)**：將遊戲版本號 (v1.9.1) 顯示於畫面右下角，方便玩家與開發者確認目前運行的版本。

## [1.9.0] - 2026-02-01 (管理員安全與正式部屬)

- **管理員安全保護**：
  - `client/src/components/AdminPanel.vue`: 實作了 **管理員密碼保護 (3377)**。只有輸入正確密碼才能進入遊戲列表與控制台。
  - 支援 `sessionStorage` 授權狀態存取，提升操作流暢度。
- **20 人大規模對戰驗證**：
  - 完成了 20 位 AI 玩家同時在線的壓力測試。
  - `server/routes/gameRoutes.js`: 修正了遊戲初始啟動時的硬編碼時長計算，改由 `calculatePhaseDuration` 統一管理，確保討論與攻擊時間隨人數正確縮放。
- **正式環境部屬**：
  - 同步推送至 GitHub `master` 分支，觸發 Render.com 自動化 CI/CD 流程。

## [1.7.0] - 2026-02-01 (穩定版基線 - Baseline Stable)

### 🚩 階段性里程碑

此版本經測試驗證，核心流程（討論、攻擊、競標、全自動 AutoPilot、AI 玩家）運作良好，視覺樣式已按需求校準，正式定為後續功能擴張的「穩定基線版」。

### Features (1.7.0)

- **核心流程完整化**：整合了討論、攻擊與競標三大核心階段，支援全自動跳轉。
- **AI 智能體系**：具備性格化行為（攻擊型、防禦型、聰明型）與智慧競標邏輯。
- **管理員控制台 (Admin Control)**：完整的對戰監控、玩家管理、自選技能與測試模式。
- **視覺卓越 (UI/UX)**：漸層動態按鈕、屬性專屬背景特效（燃燒、搖曳、電漿）、響應式佈局優化，以及**固定的競標視窗寬度**（解決因描述字數導致的抖動）。
- **穩定性強化**：實作了 Socket 斷線重連機制、廣播節流與後端安全網救災機制。

## [1.7.8] - 2026-02-01 (被動技能修復)

- `server/services/gameService.js`:
  - **核心修復**：修復了 `handleSingleAttack` 中的代碼損壞問題，確保被動技能邏輯正確。
  - **被動技能驗證**：
    - **龜甲 (Shell)**：正確減少 3 點傷害。
    - **禿鷹 (Vulture)**：場上有玩家死亡時恢復 3 HP。
    - **嗜血 (Bloodlust)**：攻擊成功時額外恢復 2 HP。
  - **死亡判定邏輯修正**：修正了 `applyDamageWithLink` 過早將玩家標記為死亡 (`isAlive=false`)，導致死亡觸發類技能（如禿鷹）無法生效的 Bug。
  - **清理**：移除了未使用的實驗性技能設定（涅槃、反擊），確保與遊戲設計一致。

## [1.8.3] - 2026-02-01 (戰局人數上限與階段時長調整)

- `client/src/components/AdminPanel.vue`:
  - 將戰局人數上限從 10 人調高至 **20 人**。
- `server/services/gameService.js`:
  - **討論階段時長優化**：調整為基礎 180 秒（3 分鐘）+ 每人額外加 20 秒，並設定總上限為 10 分鐘（600 秒）。
  - **攻擊階段時長優化**：調整為每人 30 秒，並設定總上限為 5 分鐘（300 秒）。

## [1.8.2] - 2026-02-01 (競標階段跳過問題修正)

- `server/services/gameService.js`:
  - **AutoPilot 安全網優化**：在全自動流程的超時檢查中，明確排除 `auction_transition` 階段，防止計時器衝突導致技能競標被秒跳過。
  - **佇列初始化修正**：統一使用 `auctionState.queue` 進行技能管理，移除可能導致混亂的 `itemsQueue` 舊邏輯。
  - **過渡緩衝強化**：在 `auction_transition` 進入 `auction_round` 前，增加對遊戲狀態的二次檢查與重新生成技能的「保險救援機制」，確保即使在高併發/網路延遲下，競標佇列也不會為空。
  - **狀態流轉一致性**：確保從攻擊階段結算後，技能會正確存入 `queue` 並觸發 `startAuctionForSkill`。

## [1.8.1] - 2026-02-01 (玩家個人介面 UI 優化)

- `client/src/App.vue`:
  - **按鈕位置調整**：將「準備好了 / 我已就緒」按鈕從頁面上方移動至 **玩家清單 (PlayerList) 的下方**，使其符合玩家由上往下的閱讀動線，且僅在討論階段顯示。
- `client/src/components/PlayerDashboard.vue`:
  - **介面精簡**：取消原有的「專屬代碼: P-XXXX」獨立行，將代碼直接移至玩家姓名右側，保持字體大小與層次感。
- **安全性與規範性更新**：
  - **名稱限制**：玩家命名限制為 5 個中文字內（前後端同步驗證），防止 UI 溢出。
  - **規則同步**：更新 `GameRules.vue` 內容，使其與 `gameConstants.js` 中的最新技能數值與等級資訊完全一致。
  - **部署通知**：執行生產環境編譯（Build），確保玩家看到的是最新版本的介面。

## [1.8.0] - 2026-02-01 (UI 狀態顯示修復 & 核心流程強化)

- `client/src/components/PlayerList.vue`:
  - **狀態顯示修正**：移除攻擊階段中的 `READY` 標記顯示，並限縮其僅在 `isDiscussionPhase` 時顯示。解決了使用者回報的「第四回合攻擊階段仍看到 Ready」的視覺 Bug。
- `server/routes/gameRoutes.js`:
  - **核心修補**：在手動啟動攻擊階段 (`/start-attack`) 的路由中加入玩家狀態重置邏輯 (`isReady`, `hasAttacked`)，確保手動操作與自動流程行為一致。
- `client/src/components/AdminPanel.vue`:
  - **UI 優化**：將管理員面板的寬度固定為 480px，優化手機端操作體驗，防止內容過寬導致的排版錯亂。

## [1.7.9] - 2026-02-01 (第四回合流程修復 & AI 升級強化)

- `server/services/gameService.js`:
  - **關鍵Bug修復**：修正第四回合討論階段結束後會直接跳到遊戲結束，跳過第四回合攻擊階段的嚴重 Bug。
  - **問題根因**：階段轉換邏輯中 `game.currentRound > 3` 的判斷過於籠統，在 `discussion_round_4` 結束時就已觸發遊戲結束條件。
  - **解決方案**：重構判斷邏輯，明確指定**只有從 `attack_round_4` 階段結束後才能進入 `finished`**，並加入防禦性檢查避免回合數異常。
  - **新增日誌**：在階段轉換時輸出更詳細的日誌，便於追蹤遊戲流程。

- `server/services/aiService.js`:
  - **AI 升級機率大幅提升**：
    - 基礎機率從 10% 提升至 20%
    - 聰明 AI（安全血量時）：40% → 50%
    - 笨拙 AI（足夠血量時）：20% → 35%
    - 攻擊型加成：1.5x → 1.8x
    - 防禦型減免：0.5x → 0.7x
  - **放寬升級條件**：聰明 AI 所需安全血量從 `requiredHp + 5` 降為 `requiredHp + 3`
  - **完整日誌追蹤**：每次升級檢查都會輸出詳細日誌，包含：
    - 當前血量與所需血量
    - 最終升級機率
    - 隨機判定結果
    - 決策原因（升級 ✅ 或不升級 ❌）

- `SKILL_TEST_REPORT.md`: 創建完整的技能測試報告，記錄所有 19 個技能的測試結果。

- `server/tests/verify_passive_skills.js`: 新增「噴墨」技能測試，確保傷害轉移邏輯正確。

- `server/tests/verify_skills.js`: 修正測試腳本的 duplicate key 錯誤，加入清理與唯一 playerCode。

## [1.7.7] - 2026-02-01 (遊戲結算邏輯強化)

- `server/services/gameService.js`: **結算Bug修復**，修正第四回合攻擊結束後未能正確進入結算畫面（卡在倒數）的問題。強化了階段轉換判定邏輯，明確指定 `attack_round_4` 結束後必須進入 `finished` 階段，不再單純依賴 `currentRound` 數值推算，避免因狀態異步導致的流程死鎖。

## [1.7.6] - 2026-02-01 (UI規範化與AI智能增強)

- `client/src/App.vue`: **UI 寬度規範**，將遊戲容器統一鎖定為 **480px**，確保手機與電腦瀏覽體驗一致，解決跑版問題。
- `server/services/aiService.js`: **AI 技能實裝**，賦予 AI 在討論階段主動使用技能（冬眠、瞪人、擬態、腎上腺素等）的能力，並具備性格差異判定。
- `server/services/gameService.js`: **競標修復**，修正自動導航模式下可能因佇列初始化失敗而跳過整個競標階段的 Bug。

## [1.7.5] - 2026-02-01 (管理員介面還原與佈局修復)

- `client/src/components/AdminPanel.vue`: (視覺還原) 修正管理員遊戲清單按鈕，將其恢復為原本正確的「垂直垂直排列」文字風格；修復玩家管理清單，確保維持兩行精簡格式。
- `server/services/gameService.js`: (功能恢復) 重新啟用了先前誤關閉的「全員準備就緒」與「行動完畢」快進跳轉邏輯。
- `client/src/App.vue`: (空間優化) 移除討論階段多餘的 Ready 提示文字。

## [1.7.4] - 2026-02-01 (競標流程修復)

- `server/services/gameService.js` (修復競標過渡階段被跳過的問題：精確定義「競標安全網」僅在 `auction_round` 階段生效，避免誤觸 `auction_transition`)

## [1.7.3] - 2026-02-01 (流程穩定性強化)

- `server/services/gameService.js` (強化攻擊階段重置邏輯：除 Ready 外一併重置 `hasAttacked`，並在快進判定中加入 2 秒安全緩衝，防止階段誤跳)

## [1.7.2] - 2026-02-01 (流程修復與用語簡化)

- `server/services/gameService.js` (修復攻擊階段被立即跳過的問題：進入攻擊階段時重置 Ready 狀態)
- `client/src/components/AdminPanel.vue` (用語簡化：將「加入 AI 玩家」改為「加入 AI」)
- `server/routes/gameRoutes.js` (API 訊息同步簡化)

## [1.7.1] - 2026-02-01 (UI 與日誌優化)

- `client/src/components/AuctionModal.vue` (固定彈窗寬度)
- `client/src/components/BattleLog.vue` (反轉日誌順序，最新在最上)
- `client/src/App.vue` (樣式同步、移除冗餘 Log CSS、移除偵錯專用日誌訊息)

## [1.6.8] - 2026-01-31 (階段轉換體驗優化)

### Added (1.6.8)

- **競標過渡提醒**：在攻擊階段結束後，新增了一個 3 秒的「競標過渡」階段。系統會發出通告提醒玩家即將進入競標，避免直接跳轉造成的突兀感。
- **計時器邏輯修正**：修正了進入新階段時，倒數計時器可能會短暫閃爍上一階段殘留時間的問題。現在保證在廣播前會先計算好新的結束時間。

## [1.6.7] - 2026-01-31 (競標流程穩定性修復)

### Fixed (1.6.7)

- **競標階段卡住修正**：修復了競標結束後偶爾無法自動跳回討論階段的問題。
  - 強化 `broadcastGameState` 的安全網機制，現在能更主動地偵測並救援卡在 `finished` 或 `none` 狀態的競標流程。
  - 在所有階段切換處加入 `force: true` 廣播，繞過節流限制，確保前端能立即接收到最新的階段狀態。
  - 優化 `finalizeAuctionPhase` 的重置邏輯，並加入 `try-catch` 防止單一異常導致整個流程中斷。

## [1.6.6] - 2026-01-31 (玩家體驗優化)

### Added (1.6.6)

- **簡化重新加入代碼**：現在玩家重返遊戲時，只需輸入代碼後面的 4 位數字即可（系統會自動補上 `P-` 前綴），不再需要完整輸入 `P-XXXX`。

## [1.6.5] - 2026-01-31 (同步與 Socket 通訊修正)

### Fixed (1.6.5)

- **Socket 房間大小寫一致化**：修正了原本玩家輸入小寫代碼時會加入小寫房間，而伺服器廣播至大寫房間導致同步失效的問題。現在統一強制使用大寫房間。
- **後端狀態廣播強化**：修正 `broadcastGameState` 在接收到不同大小寫的代碼時無法從資料庫撈出遊戲資料的 Bug。
- **前端連線機制優化**：在 `App.vue` 與 `AdminPanel.vue` 中加入 `handleConnect` 重連機制，確保斷線恢復後能自動重新加入正確的遊戲房間。
- **防止監聽器重複掛載**：重構 `AdminPanel.vue` 的 Socket 邏輯，使用 `off` 確保事件監聽器不會因為頁面操作而無限疊加，提升效能與穩定性。

## [1.6.4] - 2026-01-31 (玩家屬性分配修正)

### Fixed (1.6.4)

- **屬性分配邏輯集中化**：修正了原本 AI 玩家加入時會隨機分配屬性的 Bug。現在不論是真人玩家加入還是 AI 補位，皆統一遵循「平均分配水火木，餘數給雷」的核心規則。
- **版本號更新**：更新 API 版本至 `1.6.4-AttributeFix`。

## [1.6.3] - 2026-01-31 (競標計時器修復)

### Fixed (1.6.3)

- **強制競標時間同步**：修正了競標計時器可能卡在 120 秒的問題，強制將 `ACTIVE_DURATION` 設定為 **30 秒**。
- **版本號更新**：更新 API 版本至 `1.6.3-FinalTimerFix` 以確保後端邏輯重新載入。

## [1.6.2] - 2026-01-31 (AI 智能進化)

### Added (1.6.2)

- **AI 智能決策升級**：
  - **自動升級機制**：AI 現在會在討論階段根據性格與剩餘 HP 決定是否「升級 (LV Up)」。
    - `aggressive` (攻擊型) 會更積極地犧牲 HP 換取攻擊力。
    - `defensive` (防禦型) 則會保留大量 HP 緩衝，極其謹慎。
    - `smart` (聰明型) 會在血量安全的情況下穩定提升實力。
  - **性格化競標偏好**：AI 不再只是隨機出價，現在會識別技能類型。
    - 攻擊型 AI 對「適者生存」、「獠牙」等技能有極高出價熱情。
    - 防禦型 AI 則會死守「龜甲」、「斷尾」等保命神技。
  - **防重複命名機制**：確保同一場遊戲中，AI 玩家不會生成與現有玩家（真人或 AI）相同的名字。
  - **惡性競爭 (加碼機制)**：AI 現在具備「被標走後隨機加價」的意識，直到觸發其性格底線為止，大幅增加競標樂趣與挑戰性。

---

## [1.6.1] - 2026-01-31 (流程優化與節奏調整)

### Changed (1.6.1)

- **競標節奏加速**：將單項技能的競標時間從 120 秒縮短至 **30 秒**，大幅提升中後期遊戲節奏。
- **遊戲流程校正**：
  - **修復討論階段跳轉**：確保每一回合（1~4）皆有完整的「討論、攻擊、競標」流程。
  - **Ready 機制連貫**：修正了先前 R2-R4 會跳過討論的 BUG，現在每回合討論階段皆可正常點擊 Ready 提早結束。

---

## [1.6.0] - 2026-01-31 (AI 夥伴系統)

### Added (1.6.0)

- **AI 玩家系統 (AI Companion System)**：
  - **智慧命名引擎**：根據「一個動物字 + 兩個疊字」規則自動生成具備森林感的 AI 名字（如：光豬豬、圓圓狗、溜溜蛇）。
  - **性格分類機制**：AI 具備四種性格（聰明、笨拙、攻擊型、防禦型），影響其在攻擊與競標時的決策偏好。
  - **AI 決策大腦 (AI Brain)**：
    - **討論階段**：模擬人類思考隨機點擊 Ready。
    - **攻擊階段**：聰明型 AI 會計算屬性相剋進行優先打擊；攻擊型則鎖定殘血目標。
    - **競標階段**：AI 會根據性格與剩餘 HP 進行加價競爭，並具備自動加時意識。
  - **管理員手動撥入**：在 Admin Panel 的玩家管理區塊新增「🤖 加入 AI 玩家」按鈕，方便隨時補位。
  - **全自動整合**：AI 邏輯已整合至 Heartbeat 監控中，不論是否開啟 AutoPilot，只要場上有 AI 就會自動運作。

### Fixed (1.6.0)

- **修復 AI 玩家加入後的 UI 標記**：在管理介面新增 `🤖 [性格]` 標籤，方便管理員區分。
- **防止 AI 自相殘殺**：優化攻擊目標選取邏輯，確保 AI 不會攻擊已倒下或冬眠中的目標。

---

## [1.5.0] - 2026-01-31 (全自動流程系統)

### Added (1.5.0)

- **全自動流程系統 (Auto-Pilot System)**：
  - **核心邏輯**：實作伺服器端心跳監控 (Heartbeat)，每 2 秒掃描一次進行中的自動化房間。
  - **自動轉場**：根據玩家人數動態計算階段時長，逾時自動切換至下一階段（討論 -> 攻擊 -> 競標）。
  - **玩家就緒機制**：新增「準備好了」按鈕，當存活玩家全員就緒時，系統將提早 3 秒切換至攻擊階段。
  - **智慧加速**：在攻擊階段，若所有具備行動能力的玩家皆已行動，系統將自動提前結束該階段。
  - **管理員手動略過**：管理員可點擊「⏩ 略過倒時」直接強制結束當前階段的倒數。
  - **UI 控制項**：在建立房間介面新增「啟動全自動流程系統」勾選框（預設開啟）。
- **流程視覺效果 (UI Enhancement)**：
  - **全域計時器**：在遊戲頂部新增動態進度條與倒數計時文字。
  - **狀態標籤**：玩家列表現在能即時顯示「Ready」與「Acted (已行動)」標籤，方便判讀進度。

### Fixed (1.5.0)

- **修復全自動流程跳轉後「準備狀態」未重置問題**：確保下一回合討論階段玩家不會自動變為 Ready。
- **修復自動化流程進入競標階段時佇列 (Queue) 未初始化問題**：解決自動轉場時直接跳過競標階段的 Bug。
- **優化階段轉場邏輯**：整合 `transitionToNextPhase` 與 `broadcastGameState` 的超時檢查。

### Changed-Logic

- **階段轉場重構**：將階段轉換邏輯封裝至 `gameService.js` 中的 `transitionToNextPhase`，並與 `AuctionState` 系統整合。

---

## [1.4.26] - 2026-01-31

### Changed (1.4.26)

- **動態預設技能數量與隨機取樣 (Dynamic Skill Count & Random Sampling)**：
  - **規則優化**：現在當管理員未進行「自定義技能」時，每回合的預設技能數量將自動設定為「目前玩家總數的 1/2」（無條件捨去，最小為 1）。
  - **機制**：採用 **Fisher-Yates Shuffle** 演算法，從該回合的技能池中隨機進行「不重複取樣」，確保每次遊戲出現的技能組合更具多樣性。
  - **例外**：若管理員有進行「自定義技能」，則不受到數量的限制，以管理員設定的為主。

---

## [1.4.25] - 2026-01-31

### Added (1.4.25)

- **首頁可加入遊戲列表 (Joinable Games List)**：
  - **新功能**：在玩家登入頁面下方新增「今日開放中的房間」列表。
  - **機制**：自動篩選出今天建立且處於「等待中 (waiting)」狀態的遊戲。
  - **便利性**：玩家點擊列表中的房間即可自動帶入遊戲代碼，無需手動輸入。
  - **同步**：列表每 10 秒自動更新一次，並提供手動重新整理按鈕。

---

## [1.4.24] - 2026-01-31

### Fixed (1.4.24)

- **管理員控制台狀態持久化 (Admin Panel State Persistence)**：
  - **問題**：管理員在進入特定遊戲控制頁面時，若按下 F5 重新整理，頁面會跳回遊戲列表（Dashboard）甚至登入首頁。
  - **修復**：利用 `sessionStorage` 儲存管理員狀態（`forestIsAdmin`）、目前管理的遊戲代碼（`adminGameCode`）與視圖模式（`adminViewMode`）。
  - **效果**：重新整理後，管理員能自動回到原本管理的對戰控制頁面，大幅提升管理體驗。

---

## [1.4.23] - 2026-01-31 (測試完成、部屬版本)

### Changed (1.4.23)

- **專案全流程測試 (Full Process Testing)**：
  - **單元測試**：完成戰鬥傷害邏輯 (`test_battle_logic_standalone.js`) 與屬性分配算法 (`test_distribution_logic.js`) 的校驗，全部通過。
  - **模擬測試**：執行 8 人對戰全流程模擬 (`full_game_simulation_8p.js`)，確認討論、攻擊、競標、結算流程在多玩家併發下穩定運作。
  - **視覺驗證**：透過 Puppeteer 進行前端控制台視覺檢查，確認 Admin UI 樣式恢復與功能正常。
- **部屬準備**：
  - 更新版本號至 `1.4.23`。
  - 同步推送至 `master` 分支觸發 Render 自動部屬。

---

## [1.4.22-Doc-SkillDescRefine] - 2026-01-31

### Changed (1.4.22)

- **技能說明簡量化 (Skill Description Refinement)**：
  - **優化**：將所有競標技能的說明文字修改為更簡短、易懂的版本，移除冗贅描述，並將重點數值標註。
  - **特別修正**：將「獅子王」的說明修正為「指定一名手下共同發動攻擊，並分擔傷害」，以更精確描述遊戲機制。

## [1.4.21-UI-AdminStyleRestore] - 2026-01-31

### Changed-Restoration

- **管理員 UI 視覺特效恢復 (Admin UI Visual Effects Restoration)**：
  - **返回鍵**：維持 `⬅` 圖示，但恢復了懸浮變色與旋轉 90 度的動態效果。
  - **訊息框**：恢復了進入時的 slideDown 滑入動畫。
  - **遊戲 ID 區塊**：恢復了懸浮背景變色與邊框加深的效果。

## [1.4.20-UI-AdminCleanup] - 2026-01-31

### Changed

- **管理員 UI 樣式收斂 (Admin UI Style Convergence)**：
  - **返回鍵修正**：圖示回復為 `⬅`，移除滑動旋轉等特效（後於 1.4.21 恢復部分）。
  - **清理**：移除訊息框動畫（後於 1.4.21 恢復）與 ID 區域特定字型。

## [1.4.19-UI-AdminPlayerSkillTagRefine] - 2026-01-31

### Changed (1.4.19)

- **管理員控制台玩家列表技能顯示優化 (Admin Player Skill Display Refinement)**：
  - **顯示變更**：將原本僅顯示縮寫的方式改為顯示完整技能名稱。
  - **視覺設計**：為每個技能添加了淺灰色透明背景標籤樣式。

## [1.4.18-UI-AdminPlayerCodeBracketsRemove] - 2026-01-31

### Changed (1.4.18)

- **管理員控制台玩家列表調整 (Admin Player List UI Adjustment)**：
  - **修改**：移除了玩家列表顯示的玩家代碼（例如 `P-XXXX`）兩側的圓括弧。

## [1.4.17-UI-AdminPlayerSkillHide] - 2026-01-31

### Changed (1.4.17)

- **管理員控制台玩家列表調整 (Admin Player List UI Adjustment)**：
  - **修改**：在玩家管理列表中，當玩家尚未獲得任何技能時，不再顯示「(無技能)」文字。

## [1.4.16-BugFix-AdminEnterControl] - 2026-01-31

### Fixed (1.4.16)

- **修復管理員進入控制台失效問題 (Fixed Admin Control Entry Failure)**：
  - **原因**：誤用了不存在的變數與函數名稱導致 Vue 渲染錯誤。
  - **解決方案**：修正返回鍵邏輯與狀態顯示函數。

## [1.4.15-UI-AdminBackBtnMove] - 2026-01-31

### Fixed (1.4.15)

- **管理員控制台返回鍵位置調整 (Admin Back Button Move)**：
  - **位置**：將返回列表按鈕移至 Header 最右側。
  - **樣式**：改為圓形懸浮按鈕樣式。

## [1.4.14-UI-AdminHeaderCleanUp] - 2026-01-31

### Changed-Simplification

- **管理員控制台 Header 簡化 (Admin Header Simplification)**：
  - **移除**：刪除了「實時對戰控制台」文字標題，讓介面更簡潔。
  - **優化**：放大了遊戲 ID 的顯示字體 (`1.5rem`)，並移除原本的複製圖示（按鈕功能保留在 ID 文字上）。
  - **調整**：優化了 `.game-id-badge` 的間距與背景質感，使其成為 Header 的視覺重點。

## [1.4.13-UI-AdminActionCardSquare] - 2026-01-31

### Changed (1.4.13)

- **管理員控制台區塊樣式調整 (Admin Action Card Style Adjustment)**：
  - **修改**：將管理員控制台動作按鈕區域（`.action-card`）的最外層邊框圓角取消，改為直角風格。
  - **範疇**：此變更會影響「開放並加入討論階段」按鈕與「強制終止遊戲」按鈕所在的白色背景容器，使其整體視覺更加硬朗、簡約。

## [1.4.12-UI-AdminMessageRefine] - 2026-01-31

### Changed (1.4.12)

- **管理員控制台訊息提示框調整 (Admin Message Box UI Refinement)**：
  - **修改**：根據使用者提供的截圖，調整管理員控制台最上方顯示「代碼已複製！」或目前系統動作的訊息框 (`.message`)。
  - **視覺優化**：將原本的藍色背景改為 **白色背景**，並加上 **2px 黑框 (`#333`)** 與內部的深色文字。同時移除藍色陰影，改為細微的灰色陰影，提升視覺的一致性。

## [1.4.11-UI-AuctionTimerHide] - 2026-01-31

### Changed (1.4.11)

- **優化競標結算視覺 (Auction Settlement UI Optimization)**：
  - **問題**：競標結算時顯示倒數計時器（凍結在 0 秒或之前的時間），容易讓玩家誤以為還能出價或是系統卡住。
  - **解決方案**：在 `AuctionModal.vue` 的 `.auction-timer-box` 增加 `v-if="game.auctionState.status !== 'finished'"` 判斷，在結算階段自動隱藏計時器。
  - **效果**：介面在結算時更加簡潔，專注於顯示結算結果，減少操作誤導。

---

## [1.4.10-UI-AdminLayoutFix] - 2026-01-31

### Fixed (1.4.10)

- **管理員介面排版修復 (Admin UI Layout Restore)**：
  - **問題**：玩家管理卡片因樣式遺失導致內容堆疊成四行，影響閱讀效率。
  - **解決方案**：
    - 重新定義 `.p-row-1` 與 `.p-row-2` 的 Flex 佈局樣式，確保「身分資訊」與「操作按鈕」並排顯示。
    - 恢復原本的兩行式緊湊設計，提升管理員操作流暢度。

## [1.6.6-UX-LogicPolish] - 2026-02-01

### Fixed (1.6.6)

- **管理員 Session 自動跳轉修復**：修正從首頁進入管理員模式時會自動跳轉回上一次最後管理的遊戲房間的問題。現在進入時會確實清除舊 Session，確保管理員優先看到「戰局列表」。
- **列表載入保護機制**：在戰局清單尚未從資料庫讀取完成時，隱藏「建立測試戰局」按鈕，改為顯示「正在讀取...」，防止因網路延遲造成的誤重複建立。
- **階段切換邏輯強化**：同步後端 `transitionToNextPhase` 邏輯，確保在 AutoPilot 模式下階段轉換更加穩定（見 `refactor_summary.md`）。

### 📂 修改檔案清單 (1.6.6)

- `client/src/App.vue` (管理員入口 Session 清除)
- `client/src/components/AdminPanel.vue` (列表載入狀態保護、CSS 修效)
- `server/services/gameService.js` (核心階段轉換邏輯優化)

## [1.6.5-SocketFix] - 2026-01-31

### Fixed (1.6.5-S)

- **修復 Socket 斷線後重連導致的狀態異常**：
  - **問題**：玩家在遊戲中斷線後重連，有時會導致遊戲狀態不同步，例如技能按鈕消失、UI 顯示錯誤。
  - **解決方案**：在 `socket.on('reconnect')` 事件中，強制觸發 `socket.emit('requestGameState')`，確保玩家重連後能立即從伺服器獲取最新的遊戲狀態。
  - **效果**：大幅提升斷線重連後的遊戲穩定性與使用者體驗。

### 📂 修改檔案清單 (1.6.5)

- `client/src/App.vue` (新增 Socket 重連狀態請求)

## [1.4.9-AuctionFix] - 2026-01-31

### Fixed (1.4.9)

- **競標計時器深度修復**：針對用戶回報的「競標結束卡在0秒」問題進行深度修復。
- **安全網機制 (Safety Net)**：在 `broadcastGameState` 中增加對 `finished` 狀態的自動偵測與救援，若系統卡在過渡狀態超過 2 秒，將強制跳轉至下一個技能。
- **錯誤處理 (Error Handling)**：為 `settleSkillAuction` 增加 `try-catch` 保護，確保即使結算邏輯（如資料庫寫入）發生異常，仍能強制更新狀態為 `finished` 並推動遊戲進程。
- **狀態時間標記**：確保結算階段也會寫入 `endTime`，讓後端安全網能正確判斷是否逾時。

## [1.4.8-Bugfix-AuctionTimer] - 2026-01-31

### Fixed (1.4.8-1)

- **修正競標計時器卡死**：修復競標計時器在到達 0 秒後不自動跳轉至結算階段的問題。
- **防止競態條件**：優化 `broadcastGameState` 與 `setInterval` 的並行執行邏輯，確保只有一個機制能觸發結算。
- **計時器清理**：確保在狀態轉換期間正確清除並重建計時器，避免多重計時器導致的狀態異常。
- **狀態判定強化**：在結算過程中增加 `settled` 暫存狀態判定，防止自動修正機制誤觸。

## [1.4.8-Bugfix-ScoutFunction] - 2026-01-31

### Fixed (1.4.8-2)

- **修正偵查功能崩潰**：修復 `App.vue` 中缺少 `getAttributeSlug` 匯入導致偵查結果無法跳出的問題。
- **穩定性優化**：確保玩家在偵查成功後能正確接收並顯示目標屬性。

## [1.4.7-UI-SpacingOptimization] - 2026-01-30

### Fixed (1.4.7)

- **玩家資訊排版優化**：為 AdminPanel.vue 的玩家列表加入彈性的 Flex 間距，解決名字、編號與等級資訊過於擁擠的問題。
- **視覺層次提升**：透過增加 margin 與 gap，使管理員能更直覺地分辨不同玩家的身分與數值。

## [1.4.6-UI-PhaseControlCleanup] - 2026-01-30

### Changed (1.4.6)

- **精確視覺優化**：移除 AdminPanel.vue 中「遊戲階段控制按鈕」文字前的 Emoji 圖示（如 🚀、⚔️、💎、🏁），提升操作區塊的專業感。
- **保留輔助圖示**：維持複製、踢除、重新整理等功能性小圖示不變，兼顧極簡設計與操作便捷性。

## [1.4.5-Hotfix-UI-Restoration] - 2026-01-30

### Fixed

- **視覺全面還原**：應介面設計師要求，將 `AdminPanel.vue` 樣式恢復至原始版本，確保視覺風格不變。
- **彈窗定位修復**：保留 `.modal-overlay` 的 fixed 定位邏輯，解決「確認刪除彈窗」位置偏移導致使用者找不到按鈕的問題。

### 📜 規範聲明

- 已建立「邏輯/視覺分工協議」：除非功能受損，否則代理人禁止擅自更動設計師定案之 UI/UX 規範。

## [1.4.4-AuctionFix] - 2026-01-30

### Fixed (1.4.4)

- 修正後端路由 `/action/bid` 路徑不匹配問題，恢復競標功能。
- 修正 `useAuction.js` 中 `isMyBidHighest` 的 ID 比對邏輯。

### Added (1.4.4)

- 優化競標 UI：投標成功後自動清空輸入框。
- 新增競標自動填充：切換技能時自動帶入「目前最高價 + 1」。

## [1.4.3-VisualHotfix] - 2026-01-30 (玩家介面視覺體感優化)

### 🎨 玩家戰鬥介面美化 (Battle UI Aesthetics)

- **攻擊按鈕重塑 (Attack Button Redesign)**：
  - 徹底移除原本生硬的純紅色 (#e53935)，改用 **漸層紅 (Sunset Gradient)**。
  - 引入 `box-shadow` 與微小的 `scale` 懸浮動畫，增加點擊的厚實感與視覺回饋。
  - 調整為更圓潤的 `pill-style` 形狀，符合現代清新美學。
- **技能按鈕同步升級 (Skill Buttons Polish)**：
  - 為「下毒」與「查看」按鈕套用專屬的漸層色調（紫色與天藍色），並加入陰影層次。
  - 優化「偵查」按鈕的白色極簡外觀。
- **屬性筆記優化**：
  - 將猜測筆記的形狀調整為圓形（Circle），提升視覺上的韻律感。

### 📂 修改檔案清單 (Modified Files)

- `client/src/components/PlayerList.vue` (更新按鈕樣式)
- `modification_history.md` (紀錄更新)

---

## 版本 1.4.2-AdminPolish：2026/01/30 (管理員介面簡構)

### 🎨 管理員介面精簡 (Admin UI Simplification)

- **移除冗餘標題 (Redundant Header Removal)**：
  - 移除了管理員面板中「建立新戰局」的重複標題行，讓介面更加簡潔。
- **佈局優化**：
  - 減少了控制台頂部的垂直空間佔用。

### 📂 修改檔案清單 (1.4.2)

- `client/src/components/AdminPanel.vue` (移除標題行)
- `modification_history.md` (紀錄更新)

---

## 版本 1.4.1-AdminDesign：2026/01/30 (管理員面板視覺精進)

### 🎨 管理員面板視覺精進 (Admin Panel UI Refinement)

- **介面風格現代化 (Modern UI Styles)**：
  - 徹底移除粉紅色調，改用專業的 **靛藍 (Indigo) 與灰冷色調**。
  - 導入 **卡片式佈局 (Card-based Layout)** 與柔和陰影，增進層次感。
- **佈局與易用性優化 (Layout & Usability)**：
  - **結構化 Header**：在控制模式新增頂部導覽列，整合「返回」與「對戰資訊」。
  - **建立流程重塑**：將玩家人數與技能配置圖示整合進「建立新戰局」區塊，視覺更統一。
  - **按鈕視覺升級**：採用漸層漸層按鈕並加入懸浮與點擊回饋特效。
- **列表視覺對齊 (Alignment & Spacing)**：
  - 統一遊戲列表的標籤化顯示。
  - **按鈕風格回歸**：依據使用者回饋，將遊戲列表的「進入」與「刪除」按鈕恢復為經典的高對比藍/紅色調，並調整為簡潔文字而不使用圖示，確保操作直覺。
  - 修正對戰 ID 顯示區域，支援點擊自動複製。
  - 改善日誌顯示區域，採用深色調設計提升閱讀舒適度。

### 📂 修改檔案清單 (1.4.1)

- `client/src/components/AdminPanel.vue` (樣式、結構與佈局全面重塑)
- `modification_history.md` (紀錄更新)

---

## 版本 1.4.0-CoreOptimization：2026/01/30 (後端效能與結構優化)

### 🚀 後端效能與結構優化 (Backend Performance & Structure)

- **資料庫索引優化 (DB Indexing)**：
  - 為 `Player` Model 的 `gameId` 欄位新增索引，顯著提升頻繁的「遊戲-玩家」查詢效能。
- **廣播節流機制 (Socket Throttling)**：
  - 在 `broadcastGameState` 中引入 100ms 的節流鎖，防止在連鎖反應時產生重複廣播，降低伺服器與客戶端負擔。
- **重複查詢消除 (Query Optimization)**：
  - 重構 `handleAttackFlow` 與相關邏輯，直接利用已獲取的物件，減少不必要的 `findById` 呼叫。
- **核心邏輯重構 (Strategy Pattern)**：
  - 將巨大的 `useSkill` switch-case 結構重構為 `SKILL_HANDLERS` 對照表，提升程式碼可讀性與擴充性。
- **常數統一管理 (Constants Centralization)**：
  - 將分散在程式碼中的傷害數值、競標時間等 Hardcoded 常數統一抽離至 `gameConstants.js`。

### 📂 修改檔案清單 (1.4.0)

- `server/models/playerModel.js` (新增索引)
- `server/services/gameService.js` (廣播節流、邏輯重構、常數引用)
- `server/config/gameConstants.js` (新增遊戲常數)
- `modification_history.md` (紀錄更新)

---

## 版本 1.3.0-RankingMaster：2026/01/30 (結算系統與排名視覺強化)

### 🏆 結算系統修復 (Game End & Rankings)

- **結算畫面失蹤修復 (End-of-Game UI Fix)**：
  - **問題**：遊戲結束時未正確顯示排行榜，且陣亡玩家會被「死亡遮罩」卡住，無法看到最終結果。
  - **解決方案**：
    - 正式實作 `isFinishedPhase` 判定邏輯。
    - 調整層級：遊戲結束時強制移除死亡遮罩，確保所有玩家都能參與結算。
- **排名視覺強化 (Ranking UI/UX)**：
  - **個人榮耀區**：新增顯眼的「最終排名」展示，針對冠軍給予專屬的 **「森林霸主」** 祝賀詞。
  - **高亮對比標註**：排行榜中會以藍底顯眼標註 **「你 (YOU)」** 的位置。
  - **金銀銅配色**：前三名採用不同風格的色調，提升成就感。
- **返回機制**：新增「返回大廳」按鈕，取代原本僵硬的登出功能，讓流程更順暢。

### 🎨 屬性背景特效精修 (Attribute Visual Polish)

- **火屬性 (Fire)**：
  - 升級為 **「透明燃燒 (Transparent Burning)」**。
  - 採用 `0deg` 重直向上的 `fire-rise` 漸層動畫，模擬火焰升騰效果。
  - 調整為半透明 `rgba` 漸層，增加畫面細節層次。
- **木屬性 (Wood)**：
  - 加速搖曳特效：將擺動週期縮短至 **4s**，讓森林更有動感。
  - 實作對角線流動：`background-size` 提升至 400%，搭配 `sway-diagonal` 動畫，解決特效不明顯的問題。
- **雷屬性 (Thunder)**：
  - 移除多餘邊框：刪除除錯用的紫色邊框。
  - 配色優化：改用高亮粉紫與金黃的半透明漸層，營造高張力的電漿感。

### 📂 修改檔案清單 (1.3.0)

- `client/src/App.vue` (實作排名 UI、判定邏輯與關鍵樣式)
- `client/src/style.css` (全屬性背景特效調優與語法修復)
- `modification_history.md` (紀錄更新)

---

## 版本 1.2.2-GlobalStyles：2026/01/30 (樣式全域化修復)

### 🎨 樣式架構重構 (Style Refactoring)

- **屬性背景樣式全域化 (Globalized Attribute Styles)**：
  - **問題**：`App.vue` 的 Scoped CSS 機制導致在某些情境下（如動態綁定或層級變更）雷屬性背景 (`.bg-thunder`) 無法正確套用。
  - **解決方案**：
    - 將所有屬性背景 (`.bg-wood`, `.bg-water`, `.bg-fire`, `.bg-thunder`)、動畫 keyframes 與相關元件樣式從 `client/src/App.vue` 移至全域樣式表 `client/src/style.css`。
    - 確保樣式不再受 Vue Component Scope 限制，保證所有玩家屬性背景皆能穩定顯示。
  - **驗證**：修復後應能解決雷屬性背景消失的頑固問題。

### 📂 修改檔案清單 (1.2.2)

- `client/src/App.vue` (移除 Scoped 屬性樣式)
- `client/src/style.css` (新增全域屬性樣式)
- `modification_history.md` (紀錄更新)

---

## 版本 1.2.1-VisualHotfix：2026/01/30 (視覺緊急修復)

### 🎨 視覺樣式修復 (Visual Hotfixes)

- **雷屬性樣式回歸 (Thunder Attribute Restoration)**：
  - **問題**：雷屬性玩家的專屬背景色與特效在之前的重構中遺失。
  - **解決方案**：
    - 在 `client/src/App.vue` 中重新補回 `.bg-thunder` CSS 類別。
    - 實作專屬視覺：採用黃色至淡紫色的漸層背景，搭配 `shock` 斷訊感微震動動畫，並將按鈕調整為對比強烈的紫色 (`#7b1fa2`)。
  - **驗證**：雷屬性玩家現在能正確顯示其專屬的視覺識別。

### 📜 開發規範更新 (Development Guidelines)

- **UI/視覺修改協議 (UI Protocol)**：
  - 更新 `.agentrules`，新增強制性的 UI 修改限制條款。
  - 明確規範 Agent 禁止在未獲授權的情況下更動既有 CSS、版面配置或進行非必要的樣式重構。

### 📂 修改檔案清單 (1.2.1)

- `client/src/App.vue` (補回雷屬性 CSS)
- `.agentrules` (新增 UI 修改協議)
- `modification_history.md` (紀錄更新)

---

## 版本 1.2.0-CustomCreation：2026/01/26 (管理員 UI 復原與自選技能同步)

### 🎨 UI/UX 視覺重塑 (Visual Restoration)

- **介面風格回歸**：全面移除了最近一次更新引入的粉紅色配色與多餘邊框，恢復為原本受好評的簡潔淺灰/白色風格。
- **佈局優化**：
  - 恢復「建立新房間」大型按鈕。
  - 將「⚙️ 自選技能設定」整合為建立按鈕上方的一個小型文字連結，保持介面清爽。
  - 修復「返回列表」按鈕的樣式與位置，確保其在控制面板頂部且不遮擋代碼。
- **版本資訊**：系統版本號移動至 Header 下方，以半透明小字顯示，兼顧資訊揭露與美觀。

### 🆕 新增功能 (New Features)

- **建立時自選技能 (Custom Skills Tracking)**：
  - 管理員在建立房間時可預先挑選第 1-3 回合的競標池。
  - **跨裝置支援**：採用純文字純選取（●/○）設計，確保手機操作依然流暢。

### 🛠️ 系統修復與後端強化 (System Fixes & Backend Enhancements)

- **管理員 API 全面修復**：修復了因模組化重構導致的管理員 API (list, delete, kick, start 等) 遺漏問題。
- **部署自動化**：更新版本號至 1.2.0 以確保 Render 觸發完整重新構建。

### 📂 修改檔案清單 (1.2.0)

- `client/src/components/AdminPanel.vue` (UI 恢復與功能整合)
- `server/routes/gameRoutes.js` (版本號更新與 API 修復)
- `package.json` (版本號同步)
- `modification_history.md` (紀錄更新)

---

## 版本 1.0.9：2026/01/25 16:00 (UI 精修 - 得標特效置中與空白消除)

### 🎨 UI 精修 (UI Refinements)

- **得標特效完美置中 (Winning Indicator Perfect Centering)**：
  - **問題**：「得標」文字在紅框容器內未完全垂直置中,且存在多餘空白行。
  - **解決方案**：
    - 將 `.status-deco` 的定位基準從內層元素改為外層 `.auction-bid-status` 容器。
    - 使用 `position: absolute` + `top: 50%` + `transform: translateY(-50%)` 實現精確垂直置中。
    - 調整 `line-height: normal` 與 `display: flex` + `align-items: center` 確保文字本身也垂直對齊。
    - 移除 `.bid-value-row` 的 `min-height` 屬性,並調整 `padding` 為 `5px 10px`,消除多餘空白。
  - **視覺效果**：「得標」文字現在完美置中於紅框內,且下方無多餘空白,整體視覺更加精緻。

- **版本號更新**：
  - 更新 `package.json` 版本號至 `1.0.9`。
  - 更新 `/api/game/version` API 回應版本號至 `1.0.9`。

### 📂 修改檔案清單 (1.0.9)

- `client/src/App.vue` (CSS 樣式調整：`.auction-bid-status`, `.bid-value-row`, `.status-deco`)
- `server/routes/gameRoutes.js` (版本號更新)
- `package.json` (版本號更新)

---

## 版本日期：2026/01/25 (昨日深夜開發項目彙整)

### 🚀 新增與強化功能 (Features & Enhancements)

- **競標系統全面升級 (Auction System Upgrade)**：
  - **時間與邏輯**：競標時間調整為 2 分鐘，實作循序競標與動態狀態同步。
  - **價格機制**：支援最低增量加價（Incremental Bidding），並即時顯示「領先中」狀態。
  - **HP 管理**：新增競標失敗後的 HP 自動退還機制，並在彈窗顯示雙重 HP（目前 HP 與得標後預計 HP）。
  - **競標介面視覺精進 (Auction UI Refinements)**：
  - **得標特效**：將「得」、「標」二字放大並往左右對齊，增加得標時的視覺辨識度。
  - **項目顯示**：移除多餘的「目前項目」標籤，顯著放大正在競標的技能名稱。
  - **狀態文字**：更新為「競標中 (本回剩 X 項)」，並在最高出價處以粗體顯示出價者名稱。
  - **介面去蕪存菁**：移除底部繁瑣的「※ 未得標之出價將在結標後立即返還」說明文字，簡化競標介面。
  - **文字格式微調**：將最高出價者名稱移除括號並改為粗體顯示。
- **屬性筆記功能 (Attribute Guessing)**：
  - **個人紀錄標記**：在玩家列表中新增「?」小標籤，點擊可快速標註對手可能的屬性（木、水、火、雷），方便玩家進行策略推演。
  - **持久化儲存**：筆記內容會儲存在 localStorage 中，重新整理頁面後標記依然會保留。
- **後端邏輯同步**：
  - 更新 `/api/games/admin/list` 與廣播邏輯，支援傳送最高出價者的名稱。
- **UI/UX 改進與精簡**：
  - **競標介面**：實作動態 HP 比例條（Allocation Bar），並優化手動輸入框，支援自動填入最低加價金額。
  - **主動技能區**：重新設計主動技能介面，調整為簡約純白背景、極窄垂直邊距（1px），提升視覺密度。
  - **互動細節**：新增「冬眠 (Hibernate)」專屬確認彈窗，避免誤觸；遊戲結束時會自動清除所有競標狀態與彈窗。

### 🔧 邏輯優化與修正 (Logic Refinement & Bug Fixes)

- **死亡保護與狀態檢查 (Death Protection & Logic)**：
  - **死亡判定強化**：實作 HP 歸零或死亡狀態玩家無法再被攻擊，也無法發動攻擊。
  - **劇毒機制補強**：在劇毒發作導致 HP 歸零時，即時更新死亡狀態並發送通知。
- **獅子王 (Lion King) 技能調整**：
  - **手下保護**：擁有技能者（主公）現在無法攻擊自己選定的手下，避免邏輯錯誤。
  - **終局限制**：當場上存活玩家僅剩兩人時，「指定手下」功能將失效，確保決賽圈的公平性。
- **系統穩定性**：
  - 修復 `App.vue` 中因變數重複宣告導致的編譯失敗。
  - 補足 `getAttributeSlug` 函式，解決偵查 (Scout) 功能選取特定玩家時的崩潰問題。
- **自動化顯示邏輯**：
  - 當目前階段無可用主動技能時，自動隱藏該區塊，保持畫面整潔。
  - 修正 HTML 巢狀結構，確保在不同螢幕尺寸下的佈局一致性。

### 📂 修改檔案清單 (2026/01/25)

- `client/src/App.vue` (UI 介面、競標邏輯、狀態管理)
- `server/routes/gameRoutes.js` (競標後端 API、HP 退還邏輯)
- `server/models/gameModel.js` (儲存競標狀態)

---

## 版本日期：2026/01/23

### 🚀 新增功能 (New Features)

- **管理員後台功能強化**：
  - 新增 `GET /api/games/admin/list`：列出伺服器上所有進行中的遊戲與玩家人數。
  - 新增 `DELETE /api/games/admin/delete/:gameCode`：手動刪除遊戲及其關聯玩家。
  - 新增 `POST /api/games/admin/kick-player`：支援將特定玩家踢出遊戲。
  - 以及管理員直接調整玩家 HP 的功能。
- **UI 優化**：
  - 新增「技能歷史紀錄」按鈕與彈窗，讓玩家可隨時查看前幾個回合已競標的技能。
  - 調整 `App.vue` 中的按鈕文字（如：📜 技能歷史 -> 📜 技能）。
  - **[NEW] 玩家列表技能清單美化**：將原本的 `[技能A, 技能B]` 純文字格式改為獨立的橢圓標籤（Pill style），移除多餘的括號與逗號。
- **屬性分配平衡**：
  - 建立遊戲時，系統會自動預生成屬性池，確保「木、水、火」三種屬性數量平均分配，多餘的名額則填入「雷」屬性，並在玩家加入時隨機取出。

### 🔧 邏輯優化與修正 (2026/01/23)

- **戰鬥規則調整 (反擊限制)**：
  - 實作「同一回合不能攻擊先攻擊自己的人」規則。透過在玩家 `roundStats` 中新增 `attackedBy` 列表，檢查攻擊者是否在目標的回合受攻擊清單中。
- **死亡畫面改進**：
  - **離開按鈕統一**：將死亡畫面的按鈕文字改為「離開」，樣式調整為與遊戲主介面一致的紅色風格，確保操作體驗統一。
- **技能邏輯修正**：
  - **[適者生存]**：修正為攻擊成功後增加 2 攻擊（Atk+2），而非直接升級。
  - **[斷尾]**：修正為只有在「攻擊成功且造成傷害」時才會觸發逃避邏輯。
- **Bug 修正**：
  - **[獅子王]**：修復了因後端未正確連集玩家資料 (populate players) 導致「存活人數檢查」失效、進而無法指定手下的問題。
- **HP 與狀態重置**：
  - 修復了開始遊戲或下一回合時，`hasAttacked`、`attackedBy` 等回合狀態未正確重置的問題。
  - 暫時移除動態 HP 調整（統一維持 28 HP）。

### 📂 修改檔案清單 (2026/01/23)

- `server/routes/gameRoutes.js` (核心邏輯、API 實作)
- `server/models/gameModel.js` (Schema 更新)
- `server/models/playerModel.js` (Schema 更新)
- `client/src/App.vue` (UI、按鈕與彈窗邏輯)

---
*本紀錄由 Antigravity 自動彙整儲存。*
