# éŠæˆ²éšæ®µé‚è¼¯ - å¿«é€Ÿåƒè€ƒ

> é€™æ˜¯ `GAME_PHASE_LOGIC.md` çš„ç²¾ç°¡ç‰ˆï¼Œé©åˆå¿«é€ŸæŸ¥é–±

---

## ğŸ¯ æ ¸å¿ƒåŸå‰‡ï¼ˆå¿…è®€ï¼ï¼‰

### âš ï¸ é»ƒé‡‘è¦å‰‡

1. **å…ˆåˆ¤æ–·ï¼Œå†é‡ç½®**

   ```javascript
   // âœ… æ­£ç¢º
   if (shouldTransition) transitionToNextPhase();
   // åœ¨ transition å‡½æ•¸çš„æœ€å¾Œæ‰é‡ç½®ç‹€æ…‹
   
   // âŒ éŒ¯èª¤
   resetPlayerStates();
   if (shouldTransition) transitionToNextPhase(); // æ°¸é ä¸æœƒè§¸ç™¼
   ```

2. **ç«¶æ¨™éšæ®µæ˜¯ç‰¹ä¾‹**

   ```javascript
   // æ‰€æœ‰æ¶‰åŠç©å®¶ç‹€æ…‹é‡ç½®çš„åœ°æ–¹éƒ½è¦æ’é™¤ç«¶æ¨™
   if (!game.gamePhase.startsWith('auction') && 
       game.gamePhase !== 'auction_transition') {
       // æ‰èƒ½é‡ç½® isReady / hasAttacked
   }
   ```

3. **åªè¨ˆç®—å­˜æ´»ç©å®¶**

   ```javascript
   const alivePlayers = game.players.filter(p => p.status?.isAlive);
   // æ‰€æœ‰ã€Œå…¨å“¡ã€åˆ¤æ–·éƒ½åŸºæ–¼ alivePlayersï¼Œä¸æ˜¯ game.players
   ```

4. **é¿å…è¨ˆæ™‚å™¨é‡è¤‡è¨­å®š**

   ```javascript
   const remainingTime = endTime - now;
   if (remainingTime < 5000) return; // å·²ç¶“åœ¨å€’æ•¸ï¼Œä¸è¦é‡è¨­
   ```

---

## ğŸ“‹ éšæ®µæµç¨‹é€ŸæŸ¥

```
waiting â†’ discussion_1 â†’ attack_1 â†’ auction_transition â†’ auction_1 
  â†’ discussion_2 â†’ attack_2 â†’ auction_transition â†’ auction_2
  â†’ discussion_3 â†’ attack_3 â†’ auction_transition â†’ auction_3
  â†’ discussion_4 â†’ attack_4 â†’ finished
```

---

## ğŸ”§ é—œéµå‡½æ•¸é€ŸæŸ¥

| å‡½æ•¸ | ç”¨é€” | æ³¨æ„äº‹é … |
|-----|------|---------|
| `transitionToNextPhase` | éšæ®µè½‰æ›ä¸»å‡½æ•¸ | æœ€å¾Œæ‰é‡ç½®ç‹€æ…‹ï¼Œç«¶æ¨™éšæ®µä¸é‡ç½® |
| `broadcastGameState` | å»£æ’­ + è‡ªå‹•é§•é§› | æ’é™¤ç«¶æ¨™éšæ®µçš„å¿«é€²æª¢æŸ¥ |
| `checkReadyFastForward` | è¨è«–éšæ®µå¿«é€² | åªè¨ˆç®—å­˜æ´»ç©å®¶ï¼Œé¿å…é‡è¤‡è¨­å®šè¨ˆæ™‚å™¨ |
| `checkAttackFastForward` | æ”»æ“Šéšæ®µå¿«é€² | æ’é™¤æ­»äº¡+å†¬çœ ç©å®¶ |
| `startAuctionForSkill` | é–‹å§‹å–®ä¸€æŠ€èƒ½ç«¶æ¨™ | æœ‰ç¨ç«‹è¨ˆæ™‚å™¨ |
| `finalizeAuctionPhase` | çµæŸæ•´å€‹ç«¶æ¨™éšæ®µ | å›åˆæ•¸+1ï¼Œé€²å…¥ä¸‹ä¸€å›åˆè¨è«– |

---

## ğŸ› å¸¸è¦‹ Bug é€ŸæŸ¥

| ç—‡ç‹€ | åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|-----|------|---------|
| éšæ®µé€£çºŒè·³é | åˆ¤æ–·å‰å°±é‡ç½®ç‹€æ…‹ | ç§»åˆ°åˆ¤æ–·ä¹‹å¾Œ |
| è¨ˆæ™‚å™¨å¡åœ¨ 3 ç§’ | é‡è¤‡è¨­å®šå€’æ•¸ | æª¢æŸ¥å‰©é¤˜æ™‚é–“ < 5s æ™‚ä¸é‡è¨­ |
| æ­»äººé˜»å¡éŠæˆ² | è¨ˆç®—å…¨å“¡æ™‚åŒ…å«æ­»äºº | éæ¿¾ `isAlive` |
| ç«¶æ¨™è¢«è·³é | é€²å…¥ç«¶æ¨™æ™‚é‡ç½®ç‹€æ…‹ | æ’é™¤ç«¶æ¨™éšæ®µ |

---

## ğŸš¨ ä¿®æ”¹å‰æª¢æŸ¥æ¸…å–®

- [ ] æ˜¯å¦åœ¨æ­£ç¢ºæ™‚æ©Ÿé‡ç½®ç‹€æ…‹ï¼Ÿï¼ˆåˆ¤æ–·ä¹‹å¾Œï¼‰
- [ ] æ˜¯å¦æ’é™¤äº†ç«¶æ¨™éšæ®µï¼Ÿ
- [ ] æ˜¯å¦åªè¨ˆç®—å­˜æ´»ç©å®¶ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†è¨ˆæ™‚å™¨é‡è¤‡è¨­å®šï¼Ÿ
- [ ] æ˜¯å¦æ¸¬è©¦äº†é‚Šç•Œæƒ…æ³ï¼Ÿï¼ˆå…¨å“¡æ­»äº¡ã€å–®äººéŠæˆ²ç­‰ï¼‰

---

## ğŸ“„ å®Œæ•´æ–‡ä»¶

è©³ç´°èªªæ˜è«‹åƒè€ƒ: `.agent/docs/GAME_PHASE_LOGIC.md`
